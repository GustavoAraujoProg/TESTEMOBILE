<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tour Virtual 360¬∞ - Im√≥vel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: #000;
            color: #fff;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: none;
            z-index: 1;
            background-color: #000;
        }
        
        .side-panel {
            position: fixed;
            left: 20px;
            top: 20px;
            width: 50px;
            height: 10px;
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        #viewer {
            width: 100%;
            height: 100%;
            cursor: grab;
            user-select: none;
        }
        
        #viewer:active {
            cursor: grabbing;
        }

        .plan-toggle-btn {
            width: 50px;
            height: 50px;
            background: rgba(28, 87, 59, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 20px;
            text-align: center;
            box-shadow: 0 0 15px rgba(128, 128, 128, 0.3);
            position: relative;
        }

        .plan-toggle-btn:hover {
            background: #b6bec7;
            transform: scale(1.05);
        }

        .plan-toggle-btn img {
            width: 80%;
            height: auto;
            object-fit: contain;
        }
        
        .bottom-controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 1000;
        }
        
        .control-btn {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* NOVO: Bot√£o VR Mobile */
        .vr-mobile-btn {
            background: rgba(40, 167, 69, 0.8) !important;
            border: 2px solid rgba(255, 255, 255, 0.9) !important;
        }
        
        .vr-mobile-btn:hover {
            background: rgba(40, 167, 69, 1) !important;
        }

        .vr-mobile-btn.active {
            background: rgba(220, 53, 69, 0.8) !important;
            animation: pulse-vr 2s infinite;
        }

        @keyframes pulse-vr {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
            }
            50% { 
                box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
            }
        }
        
        .zoom-control {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        
        .zoom-btn {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .zoom-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .room-info {
            position: fixed;
            top: 650px;
            left: 1390px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 20px;
            border: 10px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            max-width: 300px;
        }
        
        .room-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #007bff;
        }
        
        .room-description {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.9;
        }

        /* NOVO: Status VR Mobile */
        #vr-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 12px;
            z-index: 1100;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #vr-status.active {
            display: block;
        }

        #vr-status.calibrating {
            background: rgba(255, 193, 7, 0.9);
            color: #000;
        }
        
        .photo-placeholder {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 193, 7, 0.9);
            color: #000;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            z-index: 500;
            max-width: 400px;
            border: 2px solid #ff6b35;
            display: none;
        }
        
        .nav-hotspot {
            position: fixed;
            width: 60px;
            height: 60px;
            background: rgba(0, 123, 255, 0.8);
            border: 3px solid rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 24px;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }
        
        .nav-hotspot:hover {
            transform: scale(1.1);
            background: rgba(0, 123, 255, 1);
        }
        
        @keyframes pulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7);
            }
            50% { 
                box-shadow: 0 0 0 20px rgba(0, 123, 255, 0);
            }
        }
        
        #humanized-plan-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #humanized-plan-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        #humanized-plan-modal {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            padding: 20px;
            position: absolute;
            top: 20px;
            left: 110px;
            width: 400px;
            height: 500px;
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            box-sizing: border-box;
        }

        #humanized-plan-overlay.visible #humanized-plan-modal {
            transform: scale(1);
        }

        #humanized-plan-modal .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s ease;
            z-index: 2001;
        }

        #humanized-plan-modal .close-btn:hover {
            background: #d32f2f;
        }

        #humanized-plan-image-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-color: #888;
        }

        #humanized-plan-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            cursor: grab;
            transform-origin: 0 0;
        }

        .room-hotspot-on-plan {
            position: absolute;
            background: rgba(128, 128, 128, 0.9);
            border: 3px solid #fff;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 0px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            transform: translate(-50%, -50%);
            z-index: 2000;
            pointer-events: auto;
            box-shadow: 
                0 0 0 2px rgba(128, 128, 128, 0.3),
                inset 0 0 0 6px rgba(255, 255, 255, 0.8);
        }

        .room-hotspot-on-plan:hover {
            background: rgba(160, 160, 160, 1);
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 
                0 0 10px rgba(160, 160, 160, 0.7),
                inset 0 0 0 6px rgba(255, 255, 255, 1);
            z-index: 2001;
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .caixa-com-borda{
            padding: 60px 300px;            
            width: 200px;
        }

        .image-b2n{
            justify-content: center;
            width: 800px;
            right: 400px;
            text-align: center;
            display: flex;
            align-items: center;
            border-radius: 10px;
        }

        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url('hall.png');
            background-size: cover;
            background-position: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: #fff;
            z-index: 9999;
            opacity: 1;
            visibility: visible;
            transition: opacity 1s ease-out, visibility 1s ease-out;
            backdrop-filter: blur(5px);
        }

        #splash-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 0;
        }

        #splash-screen > * {
            z-index: 1;
        }

        #splash-screen h1 {
            font-size: 3rem;
            color: #d4af37;
            margin-bottom: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .logo-splash-screen {
            max-width: 80%;
            height: auto;
            margin-bottom: 20px;
        }

        #splash-screen p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #ccc;
        }

        #start-tour-btn {
            background: #cecabe;
            color: #000;
            padding: 10px 50px;
            border: none;
            border-radius: 5px;
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 110px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
        }

        .btn-modific{
            width: 25px;
        }

        #floor-plan-panel {
            pointer-events: none;
        }

        #floor-plan-panel .floor-plan-hotspot,
        #floor-plan-panel button {
            pointer-events: auto;
        }

        #start-tour-btn:hover {
            opacity:initial;
            background: #4a882e;
            transform: translateY(-3px);
        }

        #more-info-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #more-info-overlay.visible {
            display: flex;
            opacity: 1;
        }

        #more-info-modal {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 600px;
            max-width: 90%;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        #more-info-overlay.visible #more-info-modal {
            transform: scale(1);
        }

        #more-info-modal h2 {
            font-size: 28px;
            color: #007bff;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .info-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .info-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .info-section h3 {
            font-size: 22px;
            color: #0056b3;
            margin-bottom: 10px;
        }

        .info-section p, .info-section ul {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .info-section ul {
            list-style: disc;
            margin-left: 20px;
        }

        .vr-button, .landing-page-button {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.3s ease, transform 0.3s ease;
            margin-top: 10px;
        }

        .landing-page-button {
            background: #17a2b8;
        }

        .vr-button:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .landing-page-button:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .minimalist-arrow {
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 30px solid white;
            position: relative;
            box-sizing: border-box;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .minimalist-arrow::after {
            content: '';
            position: absolute;
            top: 0;
            left: -22px;
            width: 0;
            height: 0;
            border-left: 22px solid transparent;
            border-right: 22px solid transparent;
            border-bottom: 34px solid #888;
            z-index: -1;
        }

        .minimalist-arrow:hover {
            transform: translateY(-5px);
        }

        @media (max-width: 768px) {
            #more-info-modal {
                width: 95%;
                left: 2.5%;
                top: 50%;
                transform: translateY(-50%);
                padding: 20px;
            }

            .info-section h3 {
                font-size: 18px;
            }

            .info-section p, .info-section ul, .vr-button, .landing-page-button {
                font-size: 14px;
            }
        }
        @media (max-width: 768px) {
            .room-hotspot-on-plan {
                width: 20px;
                height: 20px;
                font-size: 0px;
                border: 2px solid #fff;
            }
            
            .room-hotspot-on-plan.simple {
                width: 16px;
                height: 16px;
                border: 2px solid white;
            }
        }
         
        #logo-container {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            pointer-events: none;
        }

        #logo-central {
            border-radius: 100px;
            width: 70px;
            height: 60; 
            opacity: 0.8;
            filter: drop-shadow(0px 0px 10px rgba(0, 0, 0, 0.3));
        }

        @media (max-width: 768px) {
            #logo-central {
                height: 40px;
            }
        }

        body {
            opacity: 1 !important;
            transition: none !important;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        @media (max-width: 768px) {
            .side-panel {
                left: 10px;
                top: 10px;
                width: auto;
                padding: 10px 5px;
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: none;
            }
            
            .plan-toggle-btn {
                width: 60px;
                height: 50px;
                box-shadow: 0 0 10px rgba(48, 52, 56, 0.3);
            }

            .plan-toggle-btn img {
                width: 90%;
            }

            #humanized-plan-modal {
                top: 80px;
                left: 10px;
                width: 95%;
                height: 80%;
                max-width: 95vw;
                max-height: 80vh;
            }

            #humanized-plan-modal .close-btn {
                top: 10px;
                right: 10px;
                width: 25px;
                height: 25px;
                font-size: 16px;
            }

            #humanized-plan-image {
                max-width: 100%;
                max-height: 100%;
            }
            
            .room-hotspot-on-plan {
                width: 25px;
                height: 25px;
                font-size: 8px;
            }

            .room-info {
                left: 10px;
                max-width: 250px;
                bottom: 10px;
                top: auto;
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: none;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .zoom-control {
                right: 10px;
            }
            
            .zoom-btn {
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: none;
            }

            .bottom-controls {
                bottom: 20px;
                gap: 10px;
            }
            
            .control-btn {
                width: 45px;
                height: 45px;
                font-size: 18px;
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: none;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            #help-modal {
                width: 90%;
                left: 5%;
                top: 50%;
                transform: translateY(-50%);
                padding: 20px;
            }

            #help-overlay {
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: none;
            }

            #splash-screen {
                backdrop-filter: blur(2px);
            }

            #vr-status {
                top: 10px;
                right: 10px;
                font-size: 10px;
                padding: 8px 12px;
            }
        }
        
        .hidden {
            display: none;
        }

        #help-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #help-overlay.visible {
            display: flex;
            opacity: 1;
        }

        #help-modal {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 500px;
            max-width: 90%;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        #help-overlay.visible #help-modal {
            transform: scale(1);
        }
        
        #help-modal h2 {
            font-size: 28px;
            color: #007bff;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        #help-modal p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        #help-modal strong {
            color: #007bff;
        }

        #help-modal ul {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }

        #help-modal ul li {
            margin-bottom: 8px;
            font-size: 15px;
            display: flex;
            align-items: flex-start;
        }

        #help-modal ul li span {
            margin-right: 10px;
            font-size: 18px;
            color: #007bff;
        }

        #help-modal .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s ease;
        }

        #help-modal .close-btn:hover {
            background: #d32f2f;
        }
    </style>
</head>
<body>

    <div id="logo-container">
        <img src="./logoprincipal.png" alt="Logo b2n Engenharia" id="logo-central">
    </div>

    <div id="splash-screen">
        <div class="splash-content">
            <div class="caixa-com-borda">
                <img class="image-b2n" src="./b2n.png" alt="Imagem de fundo" style="position: relative; z-index: 1;" >
                <button id="start-tour-btn" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2;">Iniciar</button>
            </div>
        </div>
    </div>

    <!-- NOVO: Status VR Mobile -->
    <div id="vr-status">
        üì± Modo VR: Aguardando...
    </div>

    <div id="container">
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <div class="loading-text">Carregando Tour Virtual...</div>
        </div>
    
        <div class="side-panel">
            <button class="plan-toggle-btn" onclick="toggleHumanizedPlan()">
                <img src="./seta.png" alt="Planta" title="Planta Baixa Humanizada">
            </button>
        </div>
        
        <div id="viewer"></div>
        
        <div class="bottom-controls">
            <button class="control-btn" onclick="resetView()" title="Resetar Vis√£o">üîÑ</button>
            <button class="control-btn" onclick="takeScreenshot()" title="Capturar Tela">üì∑</button>
            <button class="control-btn" onclick="toggleFullscreen()" title="Tela Cheia">‚õ∂</button>
            <!-- NOVO: Bot√£o VR Mobile -->
            <button class="control-btn vr-mobile-btn" id="vr-mobile-toggle" onclick="toggleVRMobile()" title="Modo VR Mobile">üì±</button>
            <button class="control-btn" onclick="showMoreInfoModal()" title="Mais Informa√ß√µes">&#x2796;</button>
        </div>

        <div id="navigation-panel" class="navigation-panel">
            <div class="navigation-title">Navegar para:</div>
            <div id="nav-buttons-container"></div>
        </div>
    </div>

    <div id="humanized-plan-overlay">
        <div id="humanized-plan-modal">
            <button class="close-btn" onclick="hideHumanizedPlanModal()">&#x2716;</button>
            <div id="humanized-plan-image-container">
                <img id="humanized-plan-image" src="./planta1.png" alt="Planta Baixa Humanizada">
            </div>
        </div>
    </div>

    <div id="help-overlay">
        <div id="help-modal">
            <button class="close-btn" onclick="hideHelpModal()">X</button>
            <h2>Guia de Navega√ß√£o do Tour Virtual</h2>
            <p>Seja bem-vindo(a) ao seu tour virtual 360¬∞! Utilize as seguintes instru√ß√µes para explorar o ambiente:</p>
            
            <h3>Navega√ß√£o entre C√¥modos:</h3>
            <ul>
                <li><span>&#x21C6;</span> Clique no **Bot√£o de Planta** no canto esquerdo para abrir a planta baixa humanizada e selecionar um c√¥modo.</li>
                <li><span>&#x2192;</span> Ou, clique nas **setas azuis flutuantes** (hotspots) no ambiente para ir diretamente para o pr√≥ximo c√¥modo conectado.</li>
            </ul>
            <h3>Outros Controles:</h3>
            <ul>
                <li><span>&#x21BB;</span> <strong>Resetar Vis√£o:</strong> Centraliza a c√¢mera e o zoom para a vis√£o inicial do c√¥modo.</li>
                <li><span>&#x2388;</span> <strong>Capturar Tela:</strong> Salva uma imagem da sua vis√£o atual.</li>
                <li><span>&#x2B1F;</span> <strong>Tela Cheia:</strong> Ativa ou desativa o modo de tela cheia.</li>
                <li><span>üì±</span> <strong>Modo VR Mobile:</strong> Ativa os sensores do celular para navega√ß√£o imersiva.</li>
                <li><span>&#x2139;</span> <strong>Ajuda:</strong> Abre este guia.</li>
                <li><span>&#x2302;</span> <strong>In√≠cio:</strong> Retorna para a tela inicial do tour.</li>
            </ul>
        </div>
    </div>

    <div id="more-info-overlay">
        <div id="more-info-modal">
            <button class="close-btn" onclick="hideMoreInfoModal()">X</button>
            <h2>Mais Informa√ß√µes</h2>
            <div class="info-section">
                <h3>Como Usar o Tour</h3>
                <p>O tour virtual 360¬∞ √© interativo e f√°cil de usar. Utilize as seguintes op√ß√µes de navega√ß√£o:</p>
                <ul>
                    <li><strong>Clique e Arraste:</strong> Mova o mouse (ou o dedo em dispositivos m√≥veis) para girar a vis√£o 360¬∞.</li>
                    <li><strong>Scroll (Zoom):</strong> Use a roda do mouse ou o movimento de pin√ßa (em dispositivos m√≥veis) para dar zoom.</li>
                    <li><strong>Setas de Navega√ß√£o:</strong> Clique nas setas azuis flutuantes para ir para o pr√≥ximo c√¥modo ou use o bot√£o de planta no canto superior esquerdo para navegar entre os ambientes atrav√©s da planta baixa.</li>
                    <li><strong>Controles Inferiores:</strong> Utilize os bot√µes na parte inferior para resetar a vis√£o, capturar a tela, ativar/desativar tela cheia, acessar este guia de ajuda ou retornar √† tela inicial.</li>
                    <li><strong>Modo VR Mobile:</strong> Ative o bot√£o üì± para usar os sensores do seu celular e mover o dispositivo para olhar ao redor!</li>
                </ul>
            </div>
            <div class="info-section">
                <h3>Realidade Virtual (VR)</h3>
                <p>Para uma experi√™ncia mais imersiva, voc√™ pode visualizar este tour em realidade virtual.</p>
                <button class="vr-button" onclick="startVrMode()">Iniciar Modo VR</button>
            </div>
            <div class="info-section">
                <h3>Informa√ß√µes do Im√≥vel</h3>
                <p>Para mais detalhes sobre o im√≥vel, como ficha t√©cnica, valores e contato, visite a p√°gina dedicada:</p>
                <a href="URL_DA_SUA_LANDING_PAGE" target="_blank" class="landing-page-button">Ver Detalhes do Im√≥vel</a>
            </div>
        </div>
    </div>

    <script>
        let scene, camera, renderer, sphere;
        let isMouseDown = false;
        let mouseX = 0, mouseY = 0;
        let targetRotationX = 0, targetRotationY = 0;
        let rotationX = 0, rotationY = 0;
        let autoRotate = false;
        let currentRoom = 1; // Come√ßa no EXTERIOR1
        
        // ===== NOVO: Sistema VR Mobile =====
        let vrMobileEnabled = false;
        let deviceOrientationPermissionGranted = false;
        let calibrationOffset = { alpha: 0, beta: 0, gamma: 0 };
        let currentOrientation = { alpha: 0, beta: 0, gamma: 0 };
        let previousOrientation = { alpha: 0, beta: 0, gamma: 0 };
        let smoothFactor = 0.15; // Reduzido para movimento mais suave
        let sensitivity = 0.8; // Reduzido para menos sensibilidade
        let isCalibrating = false;
        let frameCount = 0;
        
        // Dados dos c√¥modos
        const rooms = [
            {
                name: "Home",
                description: "Entrada principal da resid√™ncia com vista panor√¢mica.",
                texturePath: "HOME.jpg" 
            },
            {
                name: "Exterior 1",
                description: "Vista frontal da propriedade com jardim e fachada.",
                texturePath: "EXTERIOR1.jpg" 
            },
            {
                name: "Exterior 2", 
                description: "√Årea lateral da casa com acesso ao quintal.",
                texturePath: "EXTERIOR2.jpg" 
            },
            {
                name: "Exterior 3",
                description: "Quintal com √°rea de lazer e piscina.",
                texturePath: "EXTERIOR3.jpg" 
            },
            {
                name: "Exterior 4",
                description: "√Årea da churrasqueira e espa√ßo gourmet.",
                texturePath: "EXTERIOR4.jpg" 
            },
            {
                name: "Exterior 5",
                description: "Vista dos fundos da propriedade.",
                texturePath: "EXTERIOR5.jpg" 
            },
            {
             name: "Exterior 6",
                description: "Vista dos fundos da propriedade.",
                texturePath: "EXTERIOR6.jpg" 
            },
            {
                name: "Sala 1",
                description: "Sala de estar principal com mobili√°rio moderno.",
                texturePath: "SALA1.jpg" 
            },
            {
                name: "Sala 2",
                description: "Sala de jantar integrada com cozinha.",
                texturePath: "SALA2.jpg" 
            },
            {
                name: "Sala 3",
                description: "Sala de TV e descanso.",
                texturePath: "SALA3.jpg" 
            },
            {
                name: "Cozinha",
                description: "Cozinha completa com ilha central e bancadas em granito.",
                texturePath: "COZINHA.jpg" 
            },
            {
                name: "Suite 1",
                description: "Su√≠te master com closet e vista para o jardim.",
                texturePath: "QUARTO1.jpg" 
            },
            {
                name: "Suite 2",
                description: "Quarto de h√≥spedes confort√°vel com banheiro privativo.",
                texturePath: "QUARTO2.jpg" 
            },
            {
                name: "Banheiro Suite 2",
                description: "Banheiro elegante com acabamentos de luxo.",
                texturePath: "BANHEIROQUARTO2.jpg" 
            },
            {
                name: "Banheiro Sauna",
                description: "Banheiro anexo √† sauna com chuveiro e √°rea de descanso.",
                texturePath: "BANHEIROSAUNA.jpg" 
            },
            {
                name: "Despensa",
                description: "Espa√ßo de armazenamento pr√°tico para alimentos e utens√≠lios.",
                texturePath: "DESPENSA.jpg" 
            },
            {
                name: "Lavanderia",
                description: "√Årea de servi√ßo completa com m√°quinas de lavar e secar.",
                texturePath: "LAVANDERIA.jpg" 
            },
            {
                name: "Lavabo",
                description: "Lavabo social com design moderno.",
                texturePath: "LAVABO.jpg" 
            }
        ];

        // Sistema de navega√ß√£o
        const hotspots = {
            0: [],
            1: [{ x: 0.6, y: 0.4, target: 2, label: 'Exterior 2' }],
            2: [{ x: 0.2, y: 0.4, target: 1, label: 'Exterior 1' }, { x: 0.8, y: 0.4, target: 3, label: 'Exterior 3' }],
            3: [{ x: 0.1, y: 0.3, target: 1, label: 'Exterior 1' }, { x: 0.3, y: 0.5, target: 2, label: 'Exterior 2' }, { x: 0.7, y: 0.3, target: 4, label: 'Exterior 4' }],
            4: [{ x: 0.1, y: 0.2, target: 1, label: 'Exterior 1' }, { x: 0.2, y: 0.4, target: 2, label: 'Exterior 2' }, { x: 0.3, y: 0.6, target: 3, label: 'Exterior 3' }, { x: 0.7, y: 0.3, target: 5, label: 'Exterior 5' }, { x: 0.9, y: 0.5, target: 14, label: 'Banheiro Sauna' }],
            5: [{ x: 0.1, y: 0.1, target: 1, label: 'Exterior 1' }, { x: 0.2, y: 0.3, target: 2, label: 'Exterior 2' }, { x: 0.3, y: 0.5, target: 3, label: 'Exterior 3' }, { x: 0.4, y: 0.7, target: 4, label: 'Exterior 4' }, { x: 0.7, y: 0.3, target: 6, label: 'Exterior 6' }, { x: 0.9, y: 0.4, target: 14, label: 'Banheiro Sauna' }],
            6: [{ x: 0.5, y: 0.8, target: 7, label: 'Sala 1' }, { x: 0.1, y: 0.1, target: 1, label: 'Exterior 1' }, { x: 0.2, y: 0.2, target: 2, label: 'Exterior 2' }, { x: 0.3, y: 0.3, target: 3, label: 'Exterior 3' }, { x: 0.4, y: 0.4, target: 4, label: 'Exterior 4' }, { x: 0.6, y: 0.2, target: 5, label: 'Exterior 5' }],
            7: [{ x: 0.1, y: 0.1, target: 8, label: 'Sala 2' }, { x: 0.2, y: 0.1, target: 9, label: 'Sala 3' }, { x: 0.3, y: 0.1, target: 10, label: 'Cozinha' }, { x: 0.4, y: 0.1, target: 16, label: 'Lavanderia' }, { x: 0.5, y: 0.1, target: 17, label: 'Lavabo' }, { x: 0.6, y: 0.1, target: 12, label: 'Suite 2' }, { x: 0.7, y: 0.1, target: 11, label: 'Suite 1' }, { x: 0.1, y: 0.9, target: 1, label: 'Exterior 1' }, { x: 0.2, y: 0.9, target: 2, label: 'Exterior 2' }, { x: 0.3, y: 0.9, target: 3, label: 'Exterior 3' }, { x: 0.4, y: 0.9, target: 4, label: 'Exterior 4' }, { x: 0.5, y: 0.9, target: 5, label: 'Exterior 5' }, { x: 0.6, y: 0.9, target: 6, label: 'Exterior 6' }],
            8: [{ x: 0.1, y: 0.1, target: 7, label: 'Sala 1' }, { x: 0.2, y: 0.1, target: 9, label: 'Sala 3' }, { x: 0.3, y: 0.1, target: 10, label: 'Cozinha' }, { x: 0.4, y: 0.1, target: 16, label: 'Lavanderia' }, { x: 0.5, y: 0.1, target: 17, label: 'Lavabo' }, { x: 0.6, y: 0.1, target: 12, label: 'Suite 2' }, { x: 0.7, y: 0.1, target: 11, label: 'Suite 1' }, { x: 0.1, y: 0.9, target: 1, label: 'Exterior 1' }, { x: 0.2, y: 0.9, target: 2, label: 'Exterior 2' }, { x: 0.3, y: 0.9, target: 3, label: 'Exterior 3' }, { x: 0.4, y: 0.9, target: 4, label: 'Exterior 4' }, { x: 0.5, y: 0.9, target: 5, label: 'Exterior 5' }, { x: 0.6, y: 0.9, target: 6, label: 'Exterior 6' }],
            9: [{ x: 0.1, y: 0.1, target: 7, label: 'Sala 1' }, { x: 0.2, y: 0.1, target: 8, label: 'Sala 2' }, { x: 0.3, y: 0.1, target: 10, label: 'Cozinha' }, { x: 0.4, y: 0.1, target: 16, label: 'Lavanderia' }, { x: 0.5, y: 0.1, target: 17, label: 'Lavabo' }, { x: 0.6, y: 0.1, target: 12, label: 'Suite 2' }, { x: 0.7, y: 0.1, target: 11, label: 'Suite 1' }, { x: 0.1, y: 0.9, target: 1, label: 'Exterior 1' }, { x: 0.2, y: 0.9, target: 2, label: 'Exterior 2' }, { x: 0.3, y: 0.9, target: 3, label: 'Exterior 3' }, { x: 0.4, y: 0.9, target: 4, label: 'Exterior 4' }, { x: 0.5, y: 0.9, target: 5, label: 'Exterior 5' }, { x: 0.6, y: 0.9, target: 6, label: 'Exterior 6' }],
            10: [{ x: 0.1, y: 0.1, target: 7, label: 'Sala 1' }, { x: 0.2, y: 0.1, target: 8, label: 'Sala 2' }, { x: 0.3, y: 0.1, target: 9, label: 'Sala 3' }, { x: 0.4, y: 0.1, target: 16, label: 'Lavanderia' }, { x: 0.5, y: 0.1, target: 17, label: 'Lavabo' }, { x: 0.6, y: 0.1, target: 12, label: 'Suite 2' }, { x: 0.7, y: 0.1, target: 11, label: 'Suite 1' }, { x: 0.1, y: 0.9, target: 1, label: 'Exterior 1' }, { x: 0.2, y: 0.9, target: 2, label: 'Exterior 2' }, { x: 0.3, y: 0.9, target: 3, label: 'Exterior 3' }, { x: 0.4, y: 0.9, target: 4, label: 'Exterior 4' }, { x: 0.5, y: 0.9, target: 5, label: 'Exterior 5' }, { x: 0.6, y: 0.9, target: 6, label: 'Exterior 6' }],
            11: [{ x: 0.1, y: 0.1, target: 7, label: 'Sala 1' }, { x: 0.2, y: 0.1, target: 8, label: 'Sala 2' }, { x: 0.3, y: 0.1, target: 9, label: 'Sala 3' }, { x: 0.4, y: 0.1, target: 10, label: 'Cozinha' }, { x: 0.5, y: 0.1, target: 16, label: 'Lavanderia' }, { x: 0.6, y: 0.1, target: 17, label: 'Lavabo' }, { x: 0.7, y: 0.1, target: 12, label: 'Suite 2' }, { x: 0.1, y: 0.9, target: 1, label: 'Exterior 1' }, { x: 0.2, y: 0.9, target: 2, label: 'Exterior 2' }, { x: 0.3, y: 0.9, target: 3, label: 'Exterior 3' }, { x: 0.4, y: 0.9, target: 4, label: 'Exterior 4' }, { x: 0.5, y: 0.9, target: 5, label: 'Exterior 5' }, { x: 0.6, y: 0.9, target: 6, label: 'Exterior 6' }],
            12: [{ x: 0.3, y: 0.5, target: 11, label: 'Suite 1' }, { x: 0.7, y: 0.3, target: 13, label: 'Banheiro Suite 2' }, { x: 0.5, y: 0.8, target: 9, label: 'Sala 3' }],
            13: [{ x: 0.5, y: 0.8, target: 12, label: 'Suite 2' }],
            14: [{ x: 0.3, y: 0.7, target: 4, label: 'Exterior 4' }, { x: 0.7, y: 0.7, target: 5, label: 'Exterior 5' }],
            15: [{ x: 0.1, y: 0.1, target: 7, label: 'Sala 1' }, { x: 0.2, y: 0.1, target: 8, label: 'Sala 2' }, { x: 0.3, y: 0.1, target: 9, label: 'Sala 3' }, { x: 0.4, y: 0.1, target: 10, label: 'Cozinha' }, { x: 0.5, y: 0.1, target: 16, label: 'Lavanderia' }, { x: 0.6, y: 0.1, target: 17, label: 'Lavabo' }, { x: 0.7, y: 0.1, target: 12, label: 'Suite 2' }, { x: 0.8, y: 0.1, target: 11, label: 'Suite 1' }, { x: 0.1, y: 0.9, target: 1, label: 'Exterior 1' }, { x: 0.2, y: 0.9, target: 2, label: 'Exterior 2' }, { x: 0.3, y: 0.9, target: 3, label: 'Exterior 3' }, { x: 0.4, y: 0.9, target: 4, label: 'Exterior 4' }, { x: 0.5, y: 0.9, target: 5, label: 'Exterior 5' }, { x: 0.6, y: 0.9, target: 6, label: 'Exterior 6' }],
            16: [{ x: 0.1, y: 0.1, target: 7, label: 'Sala 1' }, { x: 0.2, y: 0.1, target: 8, label: 'Sala 2' }, { x: 0.3, y: 0.1, target: 9, label: 'Sala 3' }, { x: 0.4, y: 0.1, target: 10, label: 'Cozinha' }, { x: 0.5, y: 0.1, target: 15, label: 'Despensa' }, { x: 0.6, y: 0.1, target: 17, label: 'Lavabo' }, { x: 0.7, y: 0.1, target: 12, label: 'Suite 2' }, { x: 0.8, y: 0.1, target: 11, label: 'Suite 1' }, { x: 0.1, y: 0.9, target: 1, label: 'Exterior 1' }, { x: 0.2, y: 0.9, target: 2, label: 'Exterior 2' }, { x: 0.3, y: 0.9, target: 3, label: 'Exterior 3' }, { x: 0.4, y: 0.9, target: 4, label: 'Exterior 4' }, { x: 0.5, y: 0.9, target: 5, label: 'Exterior 5' }, { x: 0.6, y: 0.9, target: 6, label: 'Exterior 6' }],
            17: [{ x: 0.1, y: 0.1, target: 7, label: 'Sala 1' }, { x: 0.2, y: 0.1, target: 8, label: 'Sala 2' }, { x: 0.3, y: 0.1, target: 9, label: 'Sala 3' }, { x: 0.4, y: 0.1, target: 10, label: 'Cozinha' }, { x: 0.5, y: 0.1, target: 15, label: 'Despensa' }, { x: 0.6, y: 0.1, target: 16, label: 'Lavanderia' }, { x: 0.7, y: 0.1, target: 12, label: 'Suite 2' }, { x: 0.8, y: 0.1, target: 11, label: 'Suite 1' }, { x: 0.1, y: 0.9, target: 1, label: 'Exterior 1' }, { x: 0.2, y: 0.9, target: 2, label: 'Exterior 2' }, { x: 0.3, y: 0.9, target: 3, label: 'Exterior 3' }, { x: 0.4, y: 0.9, target: 4, label: 'Exterior 4' }, { x: 0.5, y: 0.9, target: 5, label: 'Exterior 5' }, { x: 0.6, y: 0.9, target: 6, label: 'Exterior 6' }]
        };

        // Posi√ß√µes dos hotspots na planta baixa
        const humanizedPlanHotspotPositions = [
            { x: 50, y: 50, name: "Home" },
            { x: 20, y: 30, name: "Ext 1" },
            { x: 30, y: 20, name: "Ext 2" },
            { x: 40, y: 25, name: "Ext 3" },
            { x: 50, y: 20, name: "Ext 4" },
            { x: 60, y: 30, name: "Ext 5" },
            { x: 70, y: 40, name: "Ext 6" },
            { x: 45, y: 60, name: "Sala 1" },
            { x: 55, y: 70, name: "Sala 2" },
            { x: 65, y: 65, name: "Sala 3" },
            { x: 60, y: 80, name: "Cozinha" },
            { x: 30, y: 75, name: "Suite 1" },
            { x: 20, y: 85, name: "Suite 2" },
            { x: 15, y: 90, name: "Banh S2" },
            { x: 80, y: 50, name: "Banh Sauna" },
            { x: 70, y: 85, name: "Despensa" },
            { x: 80, y: 90, name: "Lavanderia" },
            { x: 75, y: 75, name: "Lavabo" }
        ];

        // ===== FUN√á√ïES VR MOBILE =====
        async function toggleVRMobile() {
            const vrBtn = document.getElementById('vr-mobile-toggle');
            const vrStatus = document.getElementById('vr-status');
            
            if (!vrMobileEnabled) {
                try {
                    // Verificar se o dispositivo suporta sensores
                    if (!window.DeviceOrientationEvent) {
                        alert('‚ùå Seu dispositivo n√£o suporta sensores de orienta√ß√£o');
                        return;
                    }
                    
                    // Para iOS 13+ solicitar permiss√£o
                    if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                        const permission = await DeviceOrientationEvent.requestPermission();
                        if (permission !== 'granted') {
                            alert('‚ùå Permiss√£o negada para acessar sensores');
                            return;
                        }
                        deviceOrientationPermissionGranted = true;
                    } else {
                        deviceOrientationPermissionGranted = true;
                    }
                    
                    // Ativar VR Mobile
                    vrMobileEnabled = true;
                    vrBtn.classList.add('active');
                    vrBtn.title = 'Desativar Modo VR Mobile';
                    vrStatus.classList.add('active');
                    vrStatus.innerHTML = 'üì± Modo VR: Ativo - Mova seu celular!';
                    
                    // Adicionar listener de orienta√ß√£o
                    window.addEventListener('deviceorientation', handleDeviceOrientation, { passive: true });
                    
                    // Calibrar automaticamente ap√≥s 1 segundo
                    setTimeout(() => {
                        calibrateVRMobile();
                    }, 1000);
                    
                    console.log('VR Mobile ativado');
                    
                } catch (error) {
                    console.error('Erro ao ativar VR Mobile:', error);
                    alert('‚ùå Erro ao acessar sensores do dispositivo');
                }
            } else {
                // Desativar VR Mobile
                vrMobileEnabled = false;
                vrBtn.classList.remove('active');
                vrBtn.title = 'Ativar Modo VR Mobile';
                vrStatus.classList.remove('active');
                
                // Remover listener
                window.removeEventListener('deviceorientation', handleDeviceOrientation);
                
                console.log('VR Mobile desativado');
            }
        }

        function handleDeviceOrientation(event) {
            if (!vrMobileEnabled || isCalibrating) return;
            
            // Incrementa contador de frames para suaviza√ß√£o inicial
            frameCount++;
            
            let alpha = event.alpha || 0; // Rota√ß√£o Z (compass)
            let beta = event.beta || 0;   // Rota√ß√£o X (tilt front/back)
            let gamma = event.gamma || 0; // Rota√ß√£o Y (tilt left/right)
            
            // Normalizar valores e tratar descontinuidades
            alpha = normalizeAngle(alpha);
            beta = normalizeAngle(beta);
            gamma = normalizeAngle(gamma);
            
            // Aplicar calibra√ß√£o
            let calibratedAlpha = normalizeAngle(alpha - calibrationOffset.alpha);
            let calibratedBeta = normalizeAngle(beta - calibrationOffset.beta);
            let calibratedGamma = normalizeAngle(gamma - calibrationOffset.gamma);
            
            // Detectar saltos grandes e ignorar (antiglitch)
            if (frameCount > 10) { // Ap√≥s os primeiros frames
                const alphaDiff = Math.abs(calibratedAlpha - previousOrientation.alpha);
                const betaDiff = Math.abs(calibratedBeta - previousOrientation.beta);
                const gammaDiff = Math.abs(calibratedGamma - previousOrientation.gamma);
                
                // Se mudan√ßa for muito brusca, ignore este frame
                if (alphaDiff > 45 || betaDiff > 45 || gammaDiff > 45) {
                    return;
                }
            }
            
            // Aplicar zona morta para pequenos movimentos (reduz tremor)
            const deadZone = 0.5;
            if (Math.abs(calibratedAlpha - currentOrientation.alpha) < deadZone) {
                calibratedAlpha = currentOrientation.alpha;
            }
            if (Math.abs(calibratedBeta - currentOrientation.beta) < deadZone) {
                calibratedBeta = currentOrientation.beta;
            }
            if (Math.abs(calibratedGamma - currentOrientation.gamma) < deadZone) {
                calibratedGamma = currentOrientation.gamma;
            }
            
            // Salvar orienta√ß√£o anterior
            previousOrientation.alpha = calibratedAlpha;
            previousOrientation.beta = calibratedBeta;
            previousOrientation.gamma = calibratedGamma;
            
            // Suavizar movimento com interpola√ß√£o mais lenta
            currentOrientation.alpha = lerp(currentOrientation.alpha, calibratedAlpha, smoothFactor);
            currentOrientation.beta = lerp(currentOrientation.beta, calibratedBeta, smoothFactor);
            currentOrientation.gamma = lerp(currentOrientation.gamma, calibratedGamma, smoothFactor);
            
            // Aplicar rota√ß√£o VR apenas a cada 2 frames (reduz processamento)
            if (frameCount % 2 === 0) {
                updateVRMobileRotation();
            }
            
            // Atualizar status a cada 10 frames
            if (frameCount % 10 === 0) {
                updateVRStatus();
            }
        }

        // Nova fun√ß√£o para normalizar √¢ngulos e evitar saltos
        function normalizeAngle(angle) {
            while (angle > 180) angle -= 360;
            while (angle < -180) angle += 360;
            return angle;
        }

        function updateVRMobileRotation() {
            const { alpha, beta, gamma } = currentOrientation;
            
            // Converter para radianos com sensibilidade reduzida
            const rotationXVR = -beta * sensitivity * (Math.PI / 180);
            const rotationYVR = alpha * sensitivity * (Math.PI / 180);
            
            // Limitar rota√ß√£o vertical para evitar invers√£o estranha
            const maxVerticalRotation = Math.PI / 3; // 60 graus para cima/baixo
            const clampedRotationX = Math.max(-maxVerticalRotation, Math.min(maxVerticalRotation, rotationXVR));
            
            // Aplicar rota√ß√µes suavemente
            targetRotationX = clampedRotationX;
            targetRotationY = rotationYVR;
            
            // Ignorar rota√ß√£o Z (roll) para melhor experi√™ncia
            // const rotationZVR = gamma * sensitivity * 0.1 * (Math.PI / 180);
        }

        function updateVRStatus() {
            const vrStatus = document.getElementById('vr-status');
            if (vrMobileEnabled) {
                const { alpha, beta, gamma } = currentOrientation;
                vrStatus.innerHTML = `üì± VR: üß≠${alpha.toFixed(1)}¬∞ üìê${beta.toFixed(1)}¬∞ üîÑ${gamma.toFixed(1)}¬∞`;
            }
        }

        function calibrateVRMobile() {
            if (!vrMobileEnabled) return;
            
            isCalibrating = true;
            frameCount = 0;
            
            const vrStatus = document.getElementById('vr-status');
            vrStatus.classList.add('calibrating');
            vrStatus.innerHTML = 'üéØ Calibrando... Mantenha o celular est√°vel (3s)';
            
            // Resetar orienta√ß√µes
            currentOrientation = { alpha: 0, beta: 0, gamma: 0 };
            previousOrientation = { alpha: 0, beta: 0, gamma: 0 };
            
            // Capturar m√∫ltiplas amostras para calibra√ß√£o mais est√°vel
            let samples = [];
            let sampleCount = 0;
            const totalSamples = 15; // 15 amostras em 3 segundos
            
            const calibrationHandler = (event) => {
                samples.push({
                    alpha: event.alpha || 0,
                    beta: event.beta || 0,
                    gamma: event.gamma || 0
                });
                sampleCount++;
                
                // Atualizar progresso
                const progress = Math.round((sampleCount / totalSamples) * 100);
                vrStatus.innerHTML = `üéØ Calibrando... ${progress}%`;
                
                if (sampleCount >= totalSamples) {
                    // Calcular m√©dia das amostras
                    calibrationOffset.alpha = samples.reduce((sum, s) => sum + s.alpha, 0) / samples.length;
                    calibrationOffset.beta = samples.reduce((sum, s) => sum + s.beta, 0) / samples.length;
                    calibrationOffset.gamma = samples.reduce((sum, s) => sum + s.gamma, 0) / samples.length;
                    
                    window.removeEventListener('deviceorientation', calibrationHandler);
                    
                    isCalibrating = false;
                    vrStatus.classList.remove('calibrating');
                    vrStatus.innerHTML = '‚úÖ Calibrado! Mova seu celular suavemente';
                    
                    // Resetar posi√ß√£o da c√¢mera
                    targetRotationX = 0;
                    targetRotationY = 0;
                    
                    setTimeout(() => {
                        if (vrMobileEnabled) {
                            updateVRStatus();
                        }
                    }, 3000);
                }
            };
            
            window.addEventListener('deviceorientation', calibrationHandler);
        }

        function lerp(start, end, factor) {
            return start + (end - start) * factor;
        }

        // ===== FUN√á√ïES ORIGINAIS MODIFICADAS =====
        function init() {
            console.log("Inicializando tour...");
            
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true, preserveDrawingBuffer: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            const viewer = document.getElementById('viewer');
            if (viewer) {
                viewer.innerHTML = '';
                viewer.appendChild(renderer.domElement);
                console.log("Renderer adicionado ao viewer");
            } else {
                console.error("Elemento viewer n√£o encontrado!");
                return;
            }

            createPanoramaSphere();
            setupEventListeners();

            setTimeout(() => {
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.display = 'none';
                    console.log("Loading ocultado");
                }
            }, 2000);

            animate();
            console.log("Tour inicializado com sucesso!");
        }
        
        function createPanoramaSphere() {
            console.log("Criando esfera panor√¢mica para o c√¥modo:", currentRoom, rooms[currentRoom].name);
            
            const geometry = new THREE.SphereGeometry(500, 32, 32);
            geometry.scale(-1, 1, 1);

            let material;

            const textureLoader = new THREE.TextureLoader();
            textureLoader.load(
                rooms[currentRoom].texturePath,
                (texture) => {
                    console.log("Textura carregada com sucesso:", rooms[currentRoom].texturePath);
                    if (sphere) {
                        sphere.geometry.dispose();
                        sphere.material.dispose();
                        scene.remove(sphere);
                    }
                    material = new THREE.MeshBasicMaterial({ map: texture });
                    sphere = new THREE.Mesh(geometry, material);
                    scene.add(sphere);

                    const placeholder = document.querySelector('.photo-placeholder');
                    if (placeholder) {
                        placeholder.style.display = 'none';
                    }
                },
                undefined,
                (error) => {
                    console.log("Erro ao carregar textura, usando textura din√¢mica:", error);
                    const texture = createRoomTexture(currentRoom);
                    if (sphere) {
                        sphere.geometry.dispose();
                        sphere.material.dispose();
                        scene.remove(sphere);
                    }
                    material = new THREE.MeshBasicMaterial({ map: texture });
                    sphere = new THREE.Mesh(geometry, material);
                    scene.add(sphere);

                    const placeholder = document.querySelector('.photo-placeholder');
                    if (placeholder) {
                        placeholder.style.display = 'block';
                    }
                }
            );
        }

        function createRoomTexture(roomIndex) {
            const canvas = document.createElement('canvas');
            canvas.width = 4096;
            canvas.height = 2048;
            const ctx = canvas.getContext('2d');

            const roomConfigs = [
                { colors: ['#F5DEB3', '#D2B48C'], text: "Hall de Entrada" },
                { colors: ['#A9D18E', '#8BC34A'], text: "Jardim Frontal" },
                { colors: ['#B0E0E6', '#87CEEB'], text: "Lateral da Casa" },
                { colors: ['#FFDAB9', '#FFA07A'], text: "Piscina e √Årea de Lazer" },
                { colors: ['#F0E68C', '#DAA520'], text: "Espa√ßo Gourmet" },
                { colors: ['#ADD8E6', '#87CEFA'], text: "Fundos da Propriedade" },
                { colors: ['#C0C0C0', '#A9A9A9'], text: "Varanda" },
                { colors: ['#FFF8DC', '#F0E68C'], text: "Sala de Estar" },
                { colors: ['#E6E6FA', '#DDA0DD'], text: "Sala de Jantar" },
                { colors: ['#F0F8FF', '#B0C4DE'], text: "Sala de TV" },
                { colors: ['#E0FFFF', '#AFEEEE'], text: "Cozinha Moderna" },
                { colors: ['#FFDAB9', '#F4A460'], text: "Quarto Principal" },
                { colors: ['#F0FFF0', '#90EE90'], text: "Quarto de H√≥spedes" },
                { colors: ['#F8F8FF', '#D8BFD8'], text: "Banheiro Su√≠te" },
                { colors: ['#FFEBCD', '#DAA520'], text: "Banheiro Social" },
                { colors: ['#F5DEB3', '#D2B48C'], text: "Despensa Organizada" },
                { colors: ['#F0FFF0', '#8FBC8F'], text: "Lavanderia" },
                { colors: ['#F0FFFF', '#ADD8E6'], text: "Lavabo Elegante" }
            ];

            const config = roomConfigs[roomIndex] || { colors: ['#5F9EA0', '#4682B4'], text: `C√¥modo ${roomIndex}` };

            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, config.colors[0]);
            gradient.addColorStop(1, config.colors[1]);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.font = 'Bold 150px Arial';
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(config.text, canvas.width / 2, canvas.height / 2);

            return new THREE.CanvasTexture(canvas);
        }

        function setupEventListeners() {
            const viewer = document.getElementById('viewer');
            viewer.addEventListener('mousedown', onMouseDown);
            viewer.addEventListener('mousemove', onMouseMove);
            viewer.addEventListener('mouseup', onMouseUp);
            viewer.addEventListener('mouseout', onMouseUp);
            viewer.addEventListener('wheel', onMouseWheel);

            viewer.addEventListener('touchstart', onTouchStart);
            viewer.addEventListener('touchmove', onTouchMove);
            viewer.addEventListener('touchend', onTouchEnd);

            window.addEventListener('resize', onWindowResize);

            // Sistema de zoom/pan da planta baixa
            const planImage = document.getElementById('humanized-plan-image');
            const planImageContainer = document.getElementById('humanized-plan-image-container');
            
            let scale = 1;
            let translateX = 0;
            let translateY = 0;
            let isDragging = false;
            let startX = 0;
            let startY = 0;

            function updateImageTransform() {
                planImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
                updateHotspotPositions();
            }

            function applyTransform() {
                planImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
                updateHotspotPositions();
            }

            // ZOOM COM MOUSE WHEEL
            planImage.addEventListener('wheel', (e) => {
                e.preventDefault();
                
                const zoomSpeed = 0.1;
                const rect = planImageContainer.getBoundingClientRect();
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                
                if (e.deltaY < 0) {
                    scale = Math.min(scale * (1 + zoomSpeed), 3);
                } else {
                    scale = Math.max(scale * (1 - zoomSpeed), 0.5);
                }
                
                applyTransform();
            });

            // ARRASTAR A IMAGEM
            planImage.addEventListener('mousedown', (e) => {
                isDragging = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
                planImage.style.cursor = 'grabbing';
                e.preventDefault();
            });

            planImage.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;

                    translateX = dx;
                    translateY = dy;

                    const currentWidth = planImage.naturalWidth * scale;
                    const currentHeight = planImage.naturalHeight * scale;
                    const containerWidth = planImageContainer.clientWidth;
                    const containerHeight = planImageContainer.clientHeight;

                    const maxMoveX = Math.max(0, (currentWidth - containerWidth) / 2 + 100);
                    const maxMoveY = Math.max(0, (currentHeight - containerHeight) / 2 + 100);
                    
                    translateX = Math.max(-maxMoveX, Math.min(maxMoveX, translateX));
                    translateY = Math.max(-maxMoveY, Math.min(maxMoveY, translateY));
                    
                    applyTransform();
                }
            });

            planImage.addEventListener('mouseup', () => {
                isDragging = false;
                planImage.style.cursor = 'grab';
            });

            planImage.addEventListener('mouseleave', () => {
                isDragging = false;
                planImage.style.cursor = 'grab';
            });

            // Quando a imagem carregar, cria os hotspots
            planImage.onload = () => {
                createHumanizedPlanHotspots();
            };
            if (planImage.complete) {
                createHumanizedPlanHotspots();
            }
        }

        function updateHotspotPositions(scale, translateX, translateY) {
            const planImage = document.getElementById('humanized-plan-image');
            const planImageContainer = document.getElementById('humanized-plan-image-container');
            
            if (!planImage || !planImageContainer) return;
            
            const containerRect = planImageContainer.getBoundingClientRect();
            const imageRect = planImage.getBoundingClientRect();
            
            humanizedPlanHotspotPositions.forEach((pos, index) => {
                const hotspot = document.querySelector(`.room-hotspot-on-plan[data-room-index="${index}"]`);
                if (!hotspot) return;
                
                const imageWidth = planImage.naturalWidth * scale;
                const imageHeight = planImage.naturalHeight * scale;
                
                const relativeX = (pos.x / 100) * imageWidth;
                const relativeY = (pos.y / 100) * imageHeight;
                
                const finalX = imageRect.left - containerRect.left + relativeX;
                const finalY = imageRect.top - containerRect.top + relativeY;
                
                hotspot.style.left = `${finalX}px`;
                hotspot.style.top = `${finalY}px`;
            });
        }

        function createHumanizedPlanHotspots() {
            const planImageContainer = document.getElementById('humanized-plan-image-container');
            document.querySelectorAll('.room-hotspot-on-plan').forEach(hotspot => hotspot.remove());

            humanizedPlanHotspotPositions.forEach((pos, index) => {
                const hotspot = document.createElement('div');
                hotspot.classList.add('room-hotspot-on-plan');
                hotspot.setAttribute('data-room-index', index);
                
                const planImage = document.getElementById('humanized-plan-image');
                const containerRect = planImageContainer.getBoundingClientRect();
                const imageRect = planImage.getBoundingClientRect();
                
                const imageWidth = planImage.naturalWidth;
                const imageHeight = planImage.naturalHeight;
                
                const relativeX = (pos.x / 100) * imageWidth;
                const relativeY = (pos.y / 100) * imageHeight;
                
                const finalX = imageRect.left - containerRect.left + relativeX;
                const finalY = imageRect.top - containerRect.top + relativeY;
                
                hotspot.style.left = `${finalX}px`;
                hotspot.style.top = `${finalY}px`;
                
                hotspot.title = pos.name;
                hotspot.onclick = () => changeRoom(index);
                
                planImageContainer.appendChild(hotspot);
            });
        }

        function onMouseDown(event) {
            if (vrMobileEnabled) return; // Desabilita mouse quando VR est√° ativo
            
            isMouseDown = true;
            mouseX = event.clientX;
            mouseY = event.clientY;
            document.getElementById('viewer').style.cursor = 'grabbing';
        }

        function onMouseMove(event) {
            if (!isMouseDown || vrMobileEnabled) return;
            
            const deltaX = event.clientX - mouseX;
            const deltaY = event.clientY - mouseY;
            
            targetRotationY += deltaX * 0.005;
            targetRotationX += deltaY * 0.005;
            
            targetRotationX = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, targetRotationX));
            
            mouseX = event.clientX;
            mouseY = event.clientY;
        }

        function onMouseUp() {
            isMouseDown = false;
            document.getElementById('viewer').style.cursor = 'grab';
        }

        function onMouseWheel(event) {
            event.preventDefault();
            camera.fov += event.deltaY * 0.05;
            camera.fov = Math.max(10, Math.min(100, camera.fov));
            camera.updateProjectionMatrix();
        }

        let touchStartX = 0, touchStartY = 0;
        let initialFov = camera ? camera.fov : 75;

        function onTouchStart(event) {
            if (vrMobileEnabled) return; // Desabilita touch quando VR est√° ativo
            
            if (event.touches.length === 1) {
                const touch = event.touches[0];
                mouseX = touch.clientX;
                mouseY = touch.clientY;
                isMouseDown = true;
            }
        
            event.preventDefault();
        }

        function onTouchMove(event) {
            if (vrMobileEnabled) return; // Desabilita touch quando VR est√° ativo
            
            if (event.touches.length === 1 && isMouseDown) {
                event.preventDefault();
                const touch = event.touches[0];
                
                const deltaX = touch.clientX - mouseX;
                const deltaY = touch.clientY - mouseY;
                
                targetRotationY += deltaX * 0.005;
                targetRotationX += deltaY * 0.005;
                
                targetRotationX = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, targetRotationX));
                
                mouseX = touch.clientX;
                mouseY = touch.clientY;
            }
        }

        function onTouchEnd(event) {
            isMouseDown = false;
            delete event.target.dataset.initialPinchX1;
            delete event.target.dataset.initialPinchY1;
            delete event.target.dataset.initialPinchX2;
            delete event.target.dataset.initialPinchY2;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            updateResponsiveElements();
        }
        
        function updateResponsiveElements() {
            createHotspots();
        }
        
        function animate() {
            requestAnimationFrame(animate);

            if (autoRotate && !vrMobileEnabled) {
                targetRotationY += 0.005;
            }

            // Suaviza√ß√£o mais lenta para VR mobile
            const lerpSpeed = vrMobileEnabled ? 0.05 : 0.1;
            
            rotationX += (targetRotationX - rotationX) * lerpSpeed;
            rotationY += (targetRotationY - rotationY) * lerpSpeed;

            const euler = new THREE.Euler(0, 0, 0, 'YXZ');
            euler.set(rotationX, rotationY, 0);
            camera.setRotationFromEuler(euler);

            renderer.render(scene, camera);
        }

        function toggleAutoRotate() {
            if (!vrMobileEnabled) {
                autoRotate = !autoRotate;
            }
        }

        function resetView() {
            if (vrMobileEnabled) {
                calibrateVRMobile();
            } else {
                targetRotationX = 0;
                targetRotationY = 0;
                camera.fov = 75;
                camera.updateProjectionMatrix();
            }
        }

        function changeRoom(index) {
            if (index >= 0 && index < rooms.length) {
                console.log(`Mudando para o c√¥modo ${index}: ${rooms[index].name}`);
                currentRoom = index;
                createPanoramaSphere();
                updateRoomInfo(index);
                resetView();
                createHotspots();
                hideHumanizedPlanModal(); 
            }
        }

        function updateRoomInfo(index) {
            const roomTitle = document.querySelector('.room-title');
            const roomDescription = document.querySelector('.room-description');
            if (roomTitle) roomTitle.innerText = rooms[index].name;
            if (roomDescription) roomDescription.innerText = rooms[index].description;
        }

        function createNavigationArrows() {
            console.log("=== CRIANDO SETAS DE NAVEGA√á√ÉO FIXAS ===");
            
            document.querySelectorAll('.nav-arrow').forEach(arrow => arrow.remove());
            document.querySelectorAll('.fixed-nav-arrow').forEach(arrow => arrow.remove());
            document.querySelectorAll('.test-arrow').forEach(arrow => arrow.remove());
            document.querySelectorAll('.multi-arrow').forEach(arrow => arrow.remove());
            document.querySelectorAll('.static-nav-arrow').forEach(arrow => arrow.remove());

            const currentHotspots = hotspots[currentRoom];
            console.log(`C√¥modo atual: ${currentRoom} (${rooms[currentRoom].name})`);
            console.log('Hotspots dispon√≠veis:', currentHotspots);
            
            if (!currentHotspots || currentHotspots.length === 0) {
                console.log('‚ùå Nenhum hotspot encontrado para este c√¥modo');
                return;
            }

            const fixedPositions = [
                { 
                    position: 'top: 600px; left: 50%; margin-left: -30px;',
                    icon: '<img src="botao.webp" alt="Seta para cima" style="width: 20px; height: 20px; border-radius: 50%;">',
                    name: 'topo'
                },
                { 
                    position: 'top: 120px; right: 120px;',
                    icon: '‚Üó',
                    name: 'topo-direita'
                },
                { 
                    position: 'top: 50%; right: 60px; margin-top: -30px;',
                    icon: '‚Üí',
                    name: 'direita'
                },
                { 
                    position: 'bottom: 120px; right: 120px;',
                    icon: '‚Üò',
                    name: 'baixo-direita'
                },
                { 
                    position: 'bottom: 80px; left: 50%; margin-left: -30px;',
                    icon: '‚Üì',
                    name: 'baixo'
                },
                { 
                    position: 'bottom: 120px; left: 120px;',
                    icon: '‚Üô',
                    name: 'baixo-esquerda'
                },
                { 
                    position: 'top: 50%; left: 60px; margin-top: -30px;',
                    icon: '‚Üê',
                    name: 'esquerda'
                },
                { 
                    position: 'top: 120px; left: 120px;',
                    icon: '‚Üñ',
                    name: 'topo-esquerda'
                }
            ];

            currentHotspots.forEach((hotspotData, index) => {
                if (index < fixedPositions.length) {
                    const arrow = document.createElement('div');
                    arrow.innerHTML = fixedPositions[index].icon;
                    arrow.className = 'static-nav-arrow';
                    arrow.title = `Ir para ${hotspotData.label}`;
                    
                    arrow.style.cssText = `
                        position: fixed !important;
                        ${fixedPositions[index].position}
                        width: 30px !important;
                        height: 30px !important;
                        background: rgba(128, 128, 128, 0.9) !important;
                        border: 3px solid rgba(255, 255, 255, 0.9) !important;
                        border-radius: 50% !important;
                        cursor: pointer !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        color: #fff !important;
                        font-size: 28px !important;
                        z-index: 99999 !important;
                        pointer-events: auto !important;
                        box-shadow: 0 4px 15px rgba(128, 128, 128, 0.4) !important;
                        transition: all 0.3s ease !important;
                        transform: none !important;
                        animation: none !important;
                    `;
                    
                    arrow.addEventListener('mouseenter', function() {
                        this.style.background = 'rgba(160, 160, 160, 1) !important';
                        this.style.transform = 'scale(1.1) !important';
                        this.style.boxShadow = '0 6px 20px rgba(160, 160, 160, 0.6) !important';
                    });
                    
                    arrow.addEventListener('mouseleave', function() {
                        this.style.background = 'rgba(128, 128, 128, 0.9) !important';
                        this.style.transform = 'scale(1) !important';
                        this.style.boxShadow = '0 4px 15px rgba(128, 128, 128, 0.4) !important';
                    });
                    
                    arrow.onclick = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log(`üéØ Clicando na seta ${fixedPositions[index].name} para ir para: ${hotspotData.label}`);
                        changeRoom(hotspotData.target);
                    };
                    
                    document.body.appendChild(arrow);
                    console.log(`‚úÖ Seta ${index + 1} criada na posi√ß√£o ${fixedPositions[index].name} para ${hotspotData.label}`);
                }
            });

            console.log(`‚úÖ TOTAL: ${currentHotspots.length} setas FIXAS criadas para ${rooms[currentRoom].name}`);
        }

        function createNavigationButtons() {
            const container = document.getElementById('nav-buttons-container');
            if (!container) return;
            
            container.innerHTML = '';

            const currentHotspots = hotspots[currentRoom];
            if (currentHotspots && currentHotspots.length > 0) {
                currentHotspots.forEach(hotspotData => {
                    const button = document.createElement('button');
                    button.classList.add('nav-btn');
                    button.innerText = hotspotData.label;
                    button.onclick = () => changeRoom(hotspotData.target);
                    container.appendChild(button);
                });
                
                document.getElementById('navigation-panel').style.display = 'flex';
                console.log(`Criados ${currentHotspots.length} bot√µes de navega√ß√£o para ${rooms[currentRoom].name}`);
            } else {
                document.getElementById('navigation-panel').style.display = 'none';
                console.log(`Nenhuma navega√ß√£o dispon√≠vel para ${rooms[currentRoom].name}`);
            }
        }

        function createHotspots() {
            createNavigationArrows();
            createNavigationButtons();
        }

        function takeScreenshot() {
            if (renderer) {
                try {
                    const imgData = renderer.domElement.toDataURL("image/png");
                    const link = document.createElement('a');
                    link.href = imgData;
                    link.download = `TourVirtual360_Room${currentRoom + 1}.png`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } catch (e) {
                    alert("Seu navegador pode n√£o suportar a captura de tela diretamente ou a imagem 360¬∞ pode estar em um dom√≠nio diferente. Tente um print da tela.");
                    console.error("Erro ao capturar tela:", e);
                }
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(e => {
                    console.error(`Error attempting to enable full-screen mode: ${e.message} (${e.name})`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function toggleHumanizedPlan() {
            const humanizedPlanOverlay = document.getElementById('humanized-plan-overlay');
            if (humanizedPlanOverlay.classList.contains('visible')) {
                humanizedPlanOverlay.classList.remove('visible');
            } else {
                humanizedPlanOverlay.classList.add('visible');
                const planImage = document.getElementById('humanized-plan-image');
                planImage.style.transform = `translate(0px, 0px) scale(1)`;
                scale = 1;
                translateX = 0;
                translateY = 0;
            }
        }

        function hideHumanizedPlanModal() {
            const humanizedPlanOverlay = document.getElementById('humanized-plan-overlay');
            if (humanizedPlanOverlay) {
                humanizedPlanOverlay.classList.remove('visible');
            } else {
                console.warn("Elemento 'humanized-plan-overlay' n√£o encontrado ao tentar fechar o modal.");
            }
        }

        let ambientSound;
        let soundEnabled = true;

        function playAmbientSound() {
            if (ambientSound) {
                ambientSound.stop();
                ambientSound.disconnect();
            }

            const audioContext = THREE.AudioContext.getContext();
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }

            ambientSound = new THREE.Audio(new THREE.AudioListener());
            const audioLoader = new THREE.AudioLoader();
            audioLoader.load('ambient_sound.mp3', function(buffer) {
                ambientSound.setBuffer(buffer);
                ambientSound.setLoop(true);
                ambientSound.setVolume(0.5);
                if (soundEnabled) {
                    ambientSound.play();
                }
            }, undefined, function(error) {
                console.error('Erro ao carregar o √°udio ambiente:', error);
            });
        }

        function stopAmbientSound() {
            if (ambientSound && ambientSound.isPlaying) {
                ambientSound.stop();
            }
        }

        function toggleAmbientSound() {
            soundEnabled = !soundEnabled;
            if (soundEnabled) {
                playAmbientSound();
            } else {
                stopAmbientSound();
            }
        }

        function showHelp() {
            const helpOverlay = document.getElementById('help-overlay');
            helpOverlay.classList.add('visible');
        }

        function showMoreInfoModal() {
            const moreInfoOverlay = document.getElementById('more-info-overlay');
            moreInfoOverlay.classList.add('visible');
            hideHumanizedPlanModal();
            hideHelpModal();
        }

        function hideMoreInfoModal() {
            const moreInfoOverlay = document.getElementById('more-info-overlay');
            moreInfoOverlay.classList.remove('visible');
        }

        function startVrMode() {
            alert('Modo de Realidade Virtual (VR) em desenvolvimento! Em breve voc√™ poder√° experimentar.');
        }

        function hideHelpModal() {
            const helpOverlay = document.getElementById('help-overlay');
            helpOverlay.classList.remove('visible');
        }

        // Inicializa√ß√£o do Tour
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM carregado");
            
            const startTourBtn = document.getElementById('start-tour-btn');
            
            if (!startTourBtn) {
                console.error("Bot√£o de iniciar tour n√£o encontrado!");
                return;
            }
            
            console.log("Bot√£o encontrado, adicionando evento");
            
            startTourBtn.addEventListener('click', () => {
                console.log("Bot√£o clicado - iniciando tour");
                
                const splashScreen = document.getElementById('splash-screen');
                const container = document.getElementById('container');
                
                if (!splashScreen || !container) {
                    console.error("Elementos splash-screen ou container n√£o encontrados!");
                    return;
                }
                
                splashScreen.style.opacity = '0';
                splashScreen.style.visibility = 'hidden';
                splashScreen.classList.add('hidden');
                console.log("Splash screen ocultada");

                container.style.display = 'block'; 
                container.style.zIndex = '1';
                console.log("Container mostrado");
                
                setTimeout(() => {
                    console.log("Iniciando tour ap√≥s delay...");
                    try {
                        init();
                        updateRoomInfo(currentRoom);
                        
                        // Aguarda mais um pouco antes de criar as setas
                        setTimeout(() => {
                            createHotspots(); // Cria setas e bot√µes de navega√ß√£o
                            console.log("Setas e bot√µes criados ap√≥s inicializa√ß√£o");
                        }, 1000);
                        
                        if (soundEnabled) playAmbientSound();
                        console.log("Tour inicializado com sucesso!");
                    } catch (error) {
                        console.error("Erro ao inicializar tour:", error);
                    }
                }, 500);
            });

            // Prevenir zoom e scroll em dispositivos m√≥veis durante VR
            document.addEventListener('touchstart', (e) => {
                if (vrMobileEnabled) {
                    if (e.touches.length > 1) {
                        e.preventDefault(); // Previne zoom com 2 dedos
                    }
                }
            }, { passive: false });

            document.addEventListener('touchmove', (e) => {
                if (vrMobileEnabled) {
                    e.preventDefault(); // Previne scroll durante VR
                }
            }, { passive: false });

            document.addEventListener('touchend', (e) => {
                if (vrMobileEnabled) {
                    e.preventDefault();
                }
            }, { passive: false });
        });

        function showSplashScreen() {
            const splashScreen = document.getElementById('splash-screen');
            splashScreen.classList.remove('hidden');
            splashScreen.style.opacity = '1';
            splashScreen.style.visibility = 'visible';
            document.getElementById('container').style.display = 'none';
            
            // Esconde o painel de navega√ß√£o
            const navPanel = document.getElementById('navigation-panel');
            if (navPanel) {
                navPanel.style.display = 'none';
            }
            
            // Remove TODAS as setas
            document.querySelectorAll('.nav-arrow').forEach(arrow => arrow.remove());
            document.querySelectorAll('.fixed-nav-arrow').forEach(arrow => arrow.remove());
            document.querySelectorAll('.test-arrow').forEach(arrow => arrow.remove());
            document.querySelectorAll('.multi-arrow').forEach(arrow => arrow.remove());
            document.querySelectorAll('.static-nav-arrow').forEach(arrow => arrow.remove());
            
            // Remove qualquer hotspot antigo
            document.querySelectorAll('.nav-hotspot').forEach(hotspot => hotspot.remove());
            
            // Desativa VR Mobile se estiver ativo
            if (vrMobileEnabled) {
                toggleVRMobile();
            }
            
            if (renderer) {
                renderer.dispose();
                document.getElementById('viewer').innerHTML = '';
            }
            stopAmbientSound();
        }

    </script>
</body>
</html>